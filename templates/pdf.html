<!DOCTYPE html>
<html>
<head>
  <title>AI Financial Summary</title>
  <style>
    table { border-collapse: collapse; width: 80%; }
    th, td { padding: 8px; border: 1px solid #ccc; text-align: right; }
    th { background: #f2f2f2; }
    td:first-child, th:first-child { text-align: left; }
    .ai-summary { font-style: italic; border-top: 1px solid #ccc; padding-top: 1rem; }

    /* --- PDF bookmarks (WeasyPrint) --- */
    h2 { bookmark-level: 1; bookmark-state: open; }  /* top-level entries */
    h3 { bookmark-level: 2; }                        /* optional sub-entries */
    h1, h4, h5, h6 { bookmark-level: none; }         /* suppress others */
  </style>
</head>
<body>

  {# ← Flashed error messages,to show any flash() messages from your Flask route #}
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <ul style="color: red; list-style: none; padding: 0;">
        {% for msg in messages %}
          <li>{{ msg }}</li>
        {% endfor %}
      </ul>
    {% endif %}
  {% endwith %}

  <h2>CSV Data Summary</h2>
  <table>
    <thead>
      <tr>
        <th>Company</th>
        <th>Year</th>
        <th>Line Item</th>
        <th>Value</th>
      </tr>
    </thead>
    <tbody>
      {% for row in summary %}
      <tr>
        <td>{{ row['Company'] }}</td>
        <td>{{ row['Year'] }}</td>
        <td>{{ row['LineItem'] }}</td>
        <td>{{ row['Value']|currency }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  {# ——— AI Analysis Section ——— #}
  {% if ai_text %}
    <div class="ai-summary">
      <h3>AI Analysis</h3>
      <p>{{ ai_text }}</p>
    </div>
 
  {% else %}
    <p class="ai-summary">
      <span style="color:red;">
        No AI insight was generated. Please check your API settings.
      </span>
    </p>
  {% endif %}

  {# ——— Financial Chart ——— #}
  {% if chart_data %}
    <h2>Revenue vs Net Income or Profit (in USD Billion)</h2>
    <img
      src="data:image/png;base64,{{ chart_data }}"
      alt="Latest-year grouped bars"
      style="max-width:100%;height:auto;border:1px solid #ccc;"
    />
  {% endif %}

  {% if chart_data_all %}
    <div style="page-break-before: always;"></div>
    <h2>Revenue & Net Income or Profit — All Years</h2>
    <img
      src="data:image/png;base64,{{ chart_data_all }}"
      alt="All-years line chart"
      style="max-width:100%;height:auto;border:1px solid #ccc;"
    />
  {% endif %}
  <p style="font-size:12px;color:#666;margin-top:1.5rem;">
    <em>Data disclaimer:</em> Figures shown are illustrative. Year labels may reflect
    non-aligned fiscal years across companies, and values may be normalized/rounded.
    For official results, see the issuer’s audited filings (10-K/10-Q).
  </p>
  
  
  <p><a href="{{ url_for('upload_file') }}">Upload another file</a></p>
</body>
</html>
